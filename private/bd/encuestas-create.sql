-- MySQL Script generated by MySQL Workbench
-- vie 16 nov 2018 15:22:58 CST
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

-- SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
-- SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
-- SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema encuestas
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema encuestas
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `encuestas` DEFAULT CHARACTER SET utf8 ;
USE `encuestas` ;

-- -----------------------------------------------------
-- Table `encuestas`.`division`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `encuestas`.`division` (
  `id_division` INT NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id_division`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `encuestas`.`carrera`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `encuestas`.`carrera` (
  `id_carrera` INT NOT NULL,
  `nombre` VARCHAR(60) NOT NULL,
  `id_division` INT NULL,
  PRIMARY KEY (`id_carrera`),
  INDEX `fk_carrera_division_idx` (`id_division` ASC),
  CONSTRAINT `fk_carrera_division`
    FOREIGN KEY (`id_division`)
    REFERENCES `encuestas`.`division` (`id_division`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `encuestas`.`matricula`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `encuestas`.`matricula` (
  `matricula` VARCHAR(10) NOT NULL,
  PRIMARY KEY (`matricula`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `encuestas`.`alumno`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `encuestas`.`alumno` (
  `matricula` VARCHAR(10) NOT NULL,
  `nombre` VARCHAR(45) NULL,
  `paterno` VARCHAR(45) NULL,
  `materno` VARCHAR(45) NULL,
  `id_carrera` INT NOT NULL,
  `correo` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`matricula`),
  INDEX `fk_alumno_carrera_idx` (`id_carrera` ASC),
  UNIQUE INDEX `correo_UNIQUE` (`correo` ASC),
  CONSTRAINT `fk_alumno_carrera`
    FOREIGN KEY (`id_carrera`)
    REFERENCES `encuestas`.`carrera` (`id_carrera`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_alumno_matricula`
    FOREIGN KEY (`matricula`)
    REFERENCES `encuestas`.`matricula` (`matricula`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `encuestas`.`rol`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `encuestas`.`rol` (
  `id_rol` INT NOT NULL AUTO_INCREMENT,
  `rol` VARCHAR(20) NOT NULL,
  PRIMARY KEY (`id_rol`),
  UNIQUE INDEX `rol_UNIQUE` (`rol` ASC))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `encuestas`.`login`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `encuestas`.`login` (
  `matricula` VARCHAR(10) NOT NULL,
  `password` VARCHAR(45) NOT NULL,
  `id_rol` INT NOT NULL,
  PRIMARY KEY (`matricula`),
  INDEX `fk_login_rol_idx` (`id_rol` ASC),
  CONSTRAINT `fk_login_matricula`
    FOREIGN KEY (`matricula`)
    REFERENCES `encuestas`.`matricula` (`matricula`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_login_rol`
    FOREIGN KEY (`id_rol`)
    REFERENCES `encuestas`.`rol` (`id_rol`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `encuestas`.`encuesta`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `encuestas`.`encuesta` (
  `id_encuesta` INT NOT NULL AUTO_INCREMENT,
  `titulo` VARCHAR(45) NOT NULL,
  `descripcion` VARCHAR(100) NOT NULL,
  `abre` DATETIME(0) NOT NULL,
  `cierra` DATETIME(0) NOT NULL,
  `creacion` TIMESTAMP(0) NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id_encuesta`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `encuestas`.`opcion`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `encuestas`.`opcion` (
  `id_opcion` INT NOT NULL AUTO_INCREMENT,
  `id_encuesta` INT NOT NULL,
  `opcion` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id_opcion`),
  INDEX `fk_opcion_encuesta_idx` (`id_encuesta` ASC),
  CONSTRAINT `fk_opcion_encuesta`
    FOREIGN KEY (`id_encuesta`)
    REFERENCES `encuestas`.`encuesta` (`id_encuesta`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `encuestas`.`votacion`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `encuestas`.`votacion` (
  `id_encuesta` INT NOT NULL,
  `matricula` VARCHAR(10) NOT NULL,
  `id_opcion` INT NOT NULL,
  `emision` TIMESTAMP(0) NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id_encuesta`, `matricula`),
  INDEX `fk_votacion_alumno_idx` (`matricula` ASC),
  INDEX `fk_votacion_opcion_idx` (`id_opcion` ASC),
  CONSTRAINT `fk_votacion_encuesta`
    FOREIGN KEY (`id_encuesta`)
    REFERENCES `encuestas`.`encuesta` (`id_encuesta`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_votacion_alumno`
    FOREIGN KEY (`matricula`)
    REFERENCES `encuestas`.`alumno` (`matricula`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_votacion_opcion`
    FOREIGN KEY (`id_opcion`)
    REFERENCES `encuestas`.`opcion` (`id_opcion`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `encuestas`.`administrador`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `encuestas`.`administrador` (
  `matricula` VARCHAR(10) NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`matricula`),
  CONSTRAINT `fk_administrador_matricula`
    FOREIGN KEY (`matricula`)
    REFERENCES `encuestas`.`matricula` (`matricula`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- SET SQL_MODE=@OLD_SQL_MODE;
-- SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
-- SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- -----------------------------------------------------
-- Data for table `encuestas`.`division`
-- -----------------------------------------------------
START TRANSACTION;
USE `encuestas`;
INSERT INTO `encuestas`.`division` (`id_division`, `nombre`) VALUES (1, 'Ciencias Basicas e Ingenieria');
INSERT INTO `encuestas`.`division` (`id_division`, `nombre`) VALUES (2, 'Ciencias Sociales y Humanidades');
INSERT INTO `encuestas`.`division` (`id_division`, `nombre`) VALUES (3, 'Ciencias y Artes para el Diseño');

COMMIT;


-- -----------------------------------------------------
-- Data for table `encuestas`.`carrera`
-- -----------------------------------------------------
START TRANSACTION;
USE `encuestas`;
INSERT INTO `encuestas`.`carrera` (`id_carrera`, `nombre`, `id_division`) VALUES (1, 'Ingeniería en Computación', 1);
INSERT INTO `encuestas`.`carrera` (`id_carrera`, `nombre`, `id_division`) VALUES (2, 'Ingeniería Electrónica', 1);
INSERT INTO `encuestas`.`carrera` (`id_carrera`, `nombre`, `id_division`) VALUES (3, 'Ingeniería Ambiental', 1);
INSERT INTO `encuestas`.`carrera` (`id_carrera`, `nombre`, `id_division`) VALUES (4, 'Ingeniería Física', 1);
INSERT INTO `encuestas`.`carrera` (`id_carrera`, `nombre`, `id_division`) VALUES (5, 'Licenciatura en Administración', 2);
INSERT INTO `encuestas`.`carrera` (`id_carrera`, `nombre`, `id_division`) VALUES (6, 'Licenciatura en Derecho', 2);
INSERT INTO `encuestas`.`carrera` (`id_carrera`, `nombre`, `id_division`) VALUES (7, 'Licenciatura en Economía', 2);
INSERT INTO `encuestas`.`carrera` (`id_carrera`, `nombre`, `id_division`) VALUES (8, 'Licenciatura en Diseño de la Comunicación Gráfica', 3);
INSERT INTO `encuestas`.`carrera` (`id_carrera`, `nombre`, `id_division`) VALUES (9, 'Licenciatura en Diseño Industrial', 3);
INSERT INTO `encuestas`.`carrera` (`id_carrera`, `nombre`, `id_division`) VALUES (10, 'Licanciatura en Arquitectura', 3);

COMMIT;


-- -----------------------------------------------------
-- Data for table `encuestas`.`matricula`
-- -----------------------------------------------------
START TRANSACTION;
USE `encuestas`;
INSERT INTO `encuestas`.`matricula` (`matricula`) VALUES ('2143032439');
INSERT INTO `encuestas`.`matricula` (`matricula`) VALUES ('2143032438');
INSERT INTO `encuestas`.`matricula` (`matricula`) VALUES ('2143020202');
INSERT INTO `encuestas`.`matricula` (`matricula`) VALUES ('2143030303');
INSERT INTO `encuestas`.`matricula` (`matricula`) VALUES ('123');
INSERT INTO `encuestas`.`matricula` (`matricula`) VALUES ('456');
INSERT INTO `encuestas`.`matricula` (`matricula`) VALUES ('789');
INSERT INTO `encuestas`.`matricula` (`matricula`) VALUES ('2143123456');
INSERT INTO `encuestas`.`matricula` (`matricula`) VALUES ('2143456789');

COMMIT;


-- -----------------------------------------------------
-- Data for table `encuestas`.`alumno`
-- -----------------------------------------------------
START TRANSACTION;
USE `encuestas`;
INSERT INTO `encuestas`.`alumno` (`matricula`, `nombre`, `paterno`, `materno`, `id_carrera`, `correo`) VALUES ('2143032439', 'Emilio', 'Hernandez', 'Segovia', 1, 'mok.boss@hotmail.com');
INSERT INTO `encuestas`.`alumno` (`matricula`, `nombre`, `paterno`, `materno`, `id_carrera`, `correo`) VALUES ('2143032438', 'Daniel', 'Gomez', 'Perez', 4, 'daniel.gomez@correo.com');
INSERT INTO `encuestas`.`alumno` (`matricula`, `nombre`, `paterno`, `materno`, `id_carrera`, `correo`) VALUES ('2143030303', 'Juan', 'Perez', 'Torres', 5, 'juan.perez@correo.com');
INSERT INTO `encuestas`.`alumno` (`matricula`, `nombre`, `paterno`, `materno`, `id_carrera`, `correo`) VALUES ('2143020202', 'Fernanda', 'Michelena', 'Cabrera', 8, 'fernanda.michelena@correo.com');
INSERT INTO `encuestas`.`alumno` (`matricula`, `nombre`, `paterno`, `materno`, `id_carrera`, `correo`) VALUES ('2143123456', 'Laura', 'Chapoy', 'Sola', 9, 'laura.chapoy@correo.com');
INSERT INTO `encuestas`.`alumno` (`matricula`, `nombre`, `paterno`, `materno`, `id_carrera`, `correo`) VALUES ('2143456789', 'Carlos', 'Martinez', 'Angeles', 7, 'calos.martinez@correo.com');

COMMIT;


-- -----------------------------------------------------
-- Data for table `encuestas`.`rol`
-- -----------------------------------------------------
START TRANSACTION;
USE `encuestas`;
INSERT INTO `encuestas`.`rol` (`id_rol`, `rol`) VALUES (2, 'alumno');
INSERT INTO `encuestas`.`rol` (`id_rol`, `rol`) VALUES (1, 'admin');

COMMIT;


-- -----------------------------------------------------
-- Data for table `encuestas`.`login`
-- -----------------------------------------------------
START TRANSACTION;
USE `encuestas`;
INSERT INTO `encuestas`.`login` (`matricula`, `password`, `id_rol`) VALUES ('2143032439', '2143032439', 2);
INSERT INTO `encuestas`.`login` (`matricula`, `password`, `id_rol`) VALUES ('2143032438', '2143032438', 2);
INSERT INTO `encuestas`.`login` (`matricula`, `password`, `id_rol`) VALUES ('123', '123', 1);
INSERT INTO `encuestas`.`login` (`matricula`, `password`, `id_rol`) VALUES ('456', '456', 1);
INSERT INTO `encuestas`.`login` (`matricula`, `password`, `id_rol`) VALUES ('789', '789', 1);
INSERT INTO `encuestas`.`login` (`matricula`, `password`, `id_rol`) VALUES ('2143123456', '2143123456', 2);

COMMIT;


-- -----------------------------------------------------
-- Data for table `encuestas`.`encuesta`
-- -----------------------------------------------------
START TRANSACTION;
USE `encuestas`;
INSERT INTO `encuestas`.`encuesta` (`id_encuesta`, `titulo`, `descripcion`, `abre`, `cierra`, `creacion`) VALUES (default, 'Paro', 'Por falta de agua', now(), now() + interval 1 day, default);
INSERT INTO `encuestas`.`encuesta` (`id_encuesta`, `titulo`, `descripcion`, `abre`, `cierra`, `creacion`) VALUES (default, 'Paro', 'Por falta de rector', now(), now() + interval 1 day, default);

COMMIT;


-- -----------------------------------------------------
-- Data for table `encuestas`.`opcion`
-- -----------------------------------------------------
START TRANSACTION;
USE `encuestas`;
INSERT INTO `encuestas`.`opcion` (`id_opcion`, `id_encuesta`, `opcion`) VALUES (default, 1, 'si');
INSERT INTO `encuestas`.`opcion` (`id_opcion`, `id_encuesta`, `opcion`) VALUES (default, 1, 'no');
INSERT INTO `encuestas`.`opcion` (`id_opcion`, `id_encuesta`, `opcion`) VALUES (default, 2, 'si');
INSERT INTO `encuestas`.`opcion` (`id_opcion`, `id_encuesta`, `opcion`) VALUES (default, 2, 'no');

COMMIT;


-- -----------------------------------------------------
-- Data for table `encuestas`.`administrador`
-- -----------------------------------------------------
START TRANSACTION;
USE `encuestas`;
INSERT INTO `encuestas`.`administrador` (`matricula`, `nombre`) VALUES ('123', 'AdminUno');
INSERT INTO `encuestas`.`administrador` (`matricula`, `nombre`) VALUES ('456', 'AdminDos');
INSERT INTO `encuestas`.`administrador` (`matricula`, `nombre`) VALUES ('789', 'AdminTres');

COMMIT;

CREATE USER 'equipo'@'localhost' IDENTIFIED BY 'equipo';
GRANT ALL PRIVILEGES ON encuestas.* to equipo@'localhost' IDENTIFIED BY 'equipo';
